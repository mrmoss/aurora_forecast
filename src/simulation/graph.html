<!DOCTYPE HTML>
<meta charset= "utf-8">
<html>
<head>
<script type="text/javascript" src="canvas/canvasjs.min.js"></script>
<script type="text/javascript"> 



function update_rotation (current_year_obj, next_year_obj)
{
	var rotation_index_ranges = {};
	for (var ii = 0; ii < current_year_obj.values.length; ii ++)
	{
		var startDate = {};
		startDate.year = current_year_obj.values[ii].year;
		startDate.month = current_year_obj.values[ii].month;
		startDate.day = current_year_obj.values[ii].day;

		var endDate = {};

		if(ii == current_year_obj.values.length - 1)
		{
			alert("LOOP");
			endDate.year = next_year_obj.values[0].year;
			endDate.month = next_year_obj.values[0].month;
			endDate.day = next_year_obj.values[0].day;
		}
		else
		{	
			endDate.year = current_year_obj.values[ii+1].year;
			endDate.month = current_year_obj.values[ii+1].month;
			endDate.day = current_year_obj.values[ii+1].day;
		}
		
		var dateRange = {startDate: startDate, endDate: endDate};

		var rotation_index = current_year_obj.values[ii].rotation_index;
		rotation_index_ranges[rotation_index] = dateRange;
	}
	request_data(rotation_index_ranges);	
}

function update_last_month (current_year_obj)
{
	var next_year = new Date().getFullYear() + 1;
	var request_obj = {year:next_year};
	var rotation_index_ranges = {};
	
	var url="http://aurora.cs.uaf.edu/cgi-bin/cr_cgi.py?r="+JSON.stringify(request_obj);

	var xmlhttp=new XMLHttpRequest();
	xmlhttp.open("GET",url,true);

	xmlhttp.onreadystatechange=function()
	{
		if(xmlhttp.readyState==4&&xmlhttp.status==200)
		{
			try
			{	
				var obj = JSON.parse(xmlhttp.responseText);
				update_rotation (current_year_obj, obj);			
			}
			catch(e)
			{}
		}
	}
	xmlhttp.send(null);

}

function update_chart ()
{
	var current_year = new Date().getFullYear();
	var request_obj = {year:current_year};
	var rotation_index_ranges = {};
	
	var url="http://aurora.cs.uaf.edu/cgi-bin/cr_cgi.py?r="+JSON.stringify(request_obj);

	var xmlhttp=new XMLHttpRequest();
	xmlhttp.open("GET",url,true);
	xmlhttp.onreadystatechange=function()
	{
		if(xmlhttp.readyState==4&&xmlhttp.status==200)
		{
			try
			{
				var obj = JSON.parse(xmlhttp.responseText);
				update_last_month(obj);			
			}
			catch(e)
			{}
		}
	}
	xmlhttp.send(null);
}

function drawChart () {

CanvasJS.addColorSet("colors",
		[ "grey", "lime", "yellow", "red"]); 

var rotation = 1111;
var kp = request_data("d28");

var starting_date = new Date(); 
starting_date.setDate(starting_date.getMonth() - 6 * 31); 

var forecast = new CanvasJS.Chart("chartContainer1", {colorSet: "colors" }); 

forecast.options.title = { text: "Carrington Rotation #" + rotation };
forecast.options.axisY = { gridColor: "lightgrey" };
forecast.options.axisY = { title: "Estimated Kp Index" };
forecast.options.axisX = { valueFormatString: "MMM DD", interval: 1, intervalType: "day"};

var d28_series = { 
		  markerType: "none",
		  type: "line",
		  name: "28-day forecast",
		  showInLegend: true,
};

var d3_series = {
		  type: "column",
		  name: "Max of 3-day forecast",
		  showInLegend: true,
};

forecast.options.data = [];
forecast.options.data.push(d28_series);
forecast.options.data.push(d3_series);

d28_series.dataPoints = [
{x: new Date(2014, 3, 0), y:3}, {x: new Date(2014, 3, 0), y:3}, 
{x: new Date(2014, 3, 0), y:3}, {x: new Date(2014, 3, 0), y:3}, 
{x: new Date(2014, 3, 0), y:3}, {x: new Date(2014, 3, 0), y:3}, 
{x: new Date(2014, 3, 0), y:3}, {x: new Date(2014, 3, 0), y:3}, 

{x: new Date(2014, 3, 1), y:3}, {x: new Date(2014, 3, 1), y:3}, 
{x: new Date(2014, 3, 1), y:3}, {x: new Date(2014, 3, 1), y:3}, 
{x: new Date(2014, 3, 1), y:3}, {x: new Date(2014, 3, 1), y:3}, 
{x: new Date(2014, 3, 1), y:3}, {x: new Date(2014, 3, 1), y:3}, 

{x: new Date(2014, 3, 2), y:4}, {x: new Date(2014, 3, 2), y:4}, 
{x: new Date(2014, 3, 2), y:4}, {x: new Date(2014, 3, 2), y:4}, 
{x: new Date(2014, 3, 2), y:4}, {x: new Date(2014, 3, 2), y:4}, 
{x: new Date(2014, 3, 2), y:4}, {x: new Date(2014, 3, 2), y:4}, 

{x: new Date(2014, 3, 3), y:4}, {x: new Date(2014, 3, 3), y:4}, 
{x: new Date(2014, 3, 3), y:4}, {x: new Date(2014, 3, 3), y:4}, 
{x: new Date(2014, 3, 3), y:4}, {x: new Date(2014, 3, 3), y:4}, 
{x: new Date(2014, 3, 3), y:4}, {x: new Date(2014, 3, 3), y:4}, 

{x: new Date(2014, 3, 4), y:3}, {x: new Date(2014, 3, 4), y:3},
{x: new Date(2014, 3, 4), y:3}, {x: new Date(2014, 3, 4), y:3},
{x: new Date(2014, 3, 4), y:3}, {x: new Date(2014, 3, 4), y:3},
{x: new Date(2014, 3, 4), y:3}, {x: new Date(2014, 3, 4), y:3},

{x: new Date(2014, 3, 5), y:2}, {x: new Date(2014, 3, 5), y:2},
{x: new Date(2014, 3, 5), y:2}, {x: new Date(2014, 3, 5), y:2},
{x: new Date(2014, 3, 5), y:2}, {x: new Date(2014, 3, 5), y:2},
{x: new Date(2014, 3, 5), y:2}, {x: new Date(2014, 3, 5), y:2}
];

d3_series.dataPoints = [
{x: new Date(2014, 3, 0, 0, 0), y: 1 },
{x: new Date(2014, 3, 0, 3, 0), y: 2 },
{x: new Date(2014, 3, 0, 6, 0), y: 3 },
{x: new Date(2014, 3, 0, 9, 0), y: 1 },
{x: new Date(2014, 3, 0, 12, 0), y: 2 },
{x: new Date(2014, 3, 0, 15, 0), y: 1 },
{x: new Date(2014, 3, 0, 18, 0), y: 3 },
{x: new Date(2014, 3, 0, 21, 0), y: 4 },
{x: new Date(2014, 3, 1, 0, 0), y: 0 },
{x: new Date(2014, 3, 1, 3, 0), y: 1 },
{x: new Date(2014, 3, 1, 6, 0), y: 2 },
{x: new Date(2014, 3, 1, 9, 0), y: 2 },
{x: new Date(2014, 3, 1, 12, 0), y: 3 },
{x: new Date(2014, 3, 1, 15, 0), y: 3 },
{x: new Date(2014, 3, 1, 18, 0), y: 2 },
{x: new Date(2014, 3, 1, 21, 0), y: 2 },
{x: new Date(2014, 3, 2, 3, 0), y: 2 },
{x: new Date(2014, 3, 2, 6, 0), y: 1 },
{x: new Date(2014, 3, 2, 9, 0), y: 1 },
{x: new Date(2014, 3, 2, 12, 0), y: 1 },
{x: new Date(2014, 3, 2, 15, 0), y: 1 },
{x: new Date(2014, 3, 2, 18, 0), y: 2 },
{x: new Date(2014, 3, 2, 21, 0), y: 2 },
{x: new Date(2014, 3, 3, 0, 0), y: 1 },
{x: new Date(2014, 3, 3, 3, 0), y: 1 },
{x: new Date(2014, 3, 3, 6, 0), y: 1 },
{x: new Date(2014, 3, 3, 9, 0), y: 1 },
{x: new Date(2014, 3, 3, 12, 0), y: 2 },
{x: new Date(2014, 3, 3, 15, 0), y: 1 },
{x: new Date(2014, 3, 3, 18, 0), y: 0 },
{x: new Date(2014, 3, 3, 21, 0), y: 0 },
{x: new Date(2014, 3, 4, 0, 0), y: 0 },
{x: new Date(2014, 3, 4, 3, 0), y: 1 },
{x: new Date(2014, 3, 4, 6, 0), y: 2 },
{x: new Date(2014, 3, 4, 9, 0), y: 2 },
{x: new Date(2014, 3, 4, 12, 0), y: 3 },
{x: new Date(2014, 3, 4, 15, 0), y: 3 },
{x: new Date(2014, 3, 4, 18, 0), y: 2 },
{x: new Date(2014, 3, 4, 21, 0), y: 2 },
{x: new Date(2014, 3, 5, 0, 0), y: 2 },
{x: new Date(2014, 3, 5, 3, 0), y: 2 },
{x: new Date(2014, 3, 5, 6, 0), y: 1 },
{x: new Date(2014, 3, 5, 9, 0), y: 1 },
{x: new Date(2014, 3, 5, 12, 0), y: 1 },
{x: new Date(2014, 3, 5, 15, 0), y: 1 },
{x: new Date(2014, 3, 5, 18, 0), y: 2 },
{x: new Date(2014, 3, 5, 21, 0), y: 2 },
];


 				var chart2 = new CanvasJS.Chart("chartContainer2", {
				colorSet: "greens",
 				title: { text: "Other stuff"}, 
 				data: [ {
 				type: "line",
 				dataPoints: [
 					{ x: 1, y: 5 },
 					{ x: 2, y: 1 },
 					{ x: 3, y: 2 },
 					{ x: 4, y: 3 },
 					{ x: 5, y: 8 }
 					]
 					}
 				]
 				});
 
forecast.render();
chart2.render();

function request_data(type)
		{
			var url="http://aurora.cs.uaf.edu/cgi-bin/kp_cgi.py?r=";
			var request_obj={};
			request_obj.predicted_time={year:2014,month:4,day:-1};
			request_obj.forecast=type;
			url+=JSON.stringify(request_obj);

			var xmlhttp=new XMLHttpRequest();
			xmlhttp.open("GET",url,true);

			xmlhttp.onreadystatechange=function()
			{
				alert("readystate=" + xmlhttp.readyState);
					alert("status=" + xmlhttp.status);
				if(xmlhttp.readyState==4&&xmlhttp.status==200)
				{
					var obj=JSON.parse(xmlhttp.responseText);
					obj.values.length
					obj.values[0].predicted_time.year
					obj.values[0].kp
					alert(xmlhttp.responseText);
				}
			}

			xmlhttp.send(null);
		}
}

window.onload = update_chart();

</script>
</head>

<body>
<div id="chartContainer1" style="height: 350px; width: 100%;"></div>
<div id="chartContainer2" style="height: 350px; width: 100%;"></div>
</body>
</html>

